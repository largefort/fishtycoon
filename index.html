<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- Standard mobile meta tag with zoom disabled -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
  <title>Idle Fishing Tycoon</title>
  <style>
    /* Status bar styling (only visible on Android smartphones) */
    #statusBar {
      display: none; /* Will be enabled for Android only */
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: #000;
      color: #fff;
      font-size: 0.8em;
      padding: 4px;
      display: flex;
      justify-content: space-around;
      align-items: center;
      z-index: 1000;
    }
    /* Adjust body top margin to avoid overlap with status bar */
    body.hasStatusBar {
      margin-top: 30px;
    }
    /* Base fishing-themed styling */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(to bottom, #00aaff, #0077be);
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    header {
      background: #005f99;
      width: 100%;
      text-align: center;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    #notification {
      background: #ffc107;
      color: #000;
      padding: 10px;
      text-align: center;
      width: 100%;
      display: none;
    }
    #game {
      flex: 1;
      width: 100%;
      padding: 15px;
      box-sizing: border-box;
    }
    #fishCount {
      font-size: 2em;
      margin: 10px 0;
      text-align: center;
    }
    button {
      background: #ff5722;
      color: #fff;
      border: none;
      padding: 10px 20px;
      font-size: 1em;
      border-radius: 5px;
      margin: 5px;
    }
    button:hover {
      background: #e64a19;
    }
    h2 {
      margin-top: 20px;
      text-align: center;
    }
    .section {
      margin: 10px 0;
    }
    .building {
      background: rgba(255,255,255,0.2);
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
    }
    .building button {
      margin-top: 5px;
      display: block;
      width: 100%;
    }
  </style>
</head>
<body>
  <!-- Status bar (only visible on Android smartphones) -->
  <div id="statusBar">
    <span id="mobileData">Data: N/A</span>
    <span id="clock">00:00:00</span>
    <span id="day">Day: N/A</span>
    <span id="battery">Battery: N/A</span>
  </div>
  
  <header>
    <h1>Idle Fishing Tycoon</h1>
  </header>
  <div id="notification"></div>
  <div id="game">
    <div id="fishCount">Fish: 0</div>
    <button id="fishButton">Cast Your Line!</button>
    
    <div id="buildings" class="section">
      <h2>Fishing Buildings</h2>
      <div id="buildingList"></div>
    </div>
  </div>
  
  <script>
    /* ------------------------------------------
       Utility: Check if device is Android smartphone
    ------------------------------------------- */
    function isAndroid() {
      return /Android/i.test(navigator.userAgent);
    }
    
    /* ------------------------------------------
       AUTO UI FIXER FUNCTION
    ------------------------------------------- */
    function autoUiFixer() {
      if (isAndroid()) {
        const deviceWidth = window.innerWidth;
        let baseFontSize = (deviceWidth < 360) ? 14 : 16;
        document.documentElement.style.fontSize = baseFontSize + "px";
        const style = document.createElement('style');
        style.innerHTML = `
          header { padding: 10px !important; }
          #fishCount { font-size: 1.5em !important; margin: 5px 0 !important; }
          button { padding: 8px 16px !important; font-size: 0.9em !important; margin: 4px !important; }
          .building { padding: 8px !important; margin: 8px 0 !important; }
        `;
        document.head.appendChild(style);
      }
    }
    autoUiFixer();
    
    /* ------------------------------------------
       DISABLE ZOOM FUNCTION (but allow single-finger scrolling)
    ------------------------------------------- */
    function disableZoom() {
      // The viewport meta tag already fixes scale via the content attribute.
      // Prevent pinch zoom by intercepting multi-touch events.
      document.addEventListener('touchmove', function(e) {
        if (e.touches.length > 1) {
          e.preventDefault();
        }
      }, { passive: false });
    }
    disableZoom();
    
    /* ------------------------------------------
       GAME STATE & VARIABLES + AUTOSAVE/LOAD
    ------------------------------------------- */
    let fish = 0;
    let displayedFish = fish;
    
    // Define fishing-themed production buildings.
    const buildings = [
      { id: 'fishingBoat', name: 'Fishing Boat', count: 0, baseCost: 50, cost: 50, baseProduction: 1, level: 1, upgradeCost: 100 },
      { id: 'netWorkshop', name: 'Net Workshop', count: 0, baseCost: 200, cost: 200, baseProduction: 5, level: 1, upgradeCost: 400 },
      { id: 'fishMarket', name: 'Fish Market', count: 0, baseCost: 1000, cost: 1000, baseProduction: 20, level: 1, upgradeCost: 2000 },
      { id: 'harborDock', name: 'Harbor Dock', count: 0, baseCost: 5000, cost: 5000, baseProduction: 100, level: 1, upgradeCost: 10000 },
      { id: 'baitFactory', name: 'Bait Factory', count: 0, baseCost: 20000, cost: 20000, baseProduction: 500, level: 1, upgradeCost: 40000 },
      { id: 'offshoreVessel', name: 'Offshore Vessel', count: 0, baseCost: 100000, cost: 100000, baseProduction: 2000, level: 1, upgradeCost: 200000 },
      { id: 'aquacultureFarm', name: 'Aquaculture Farm', count: 0, baseCost: 500000, cost: 500000, baseProduction: 5000, level: 1, upgradeCost: 1000000 }
    ];
    
    // Autosave: Save game state to localStorage
    function saveGame() {
      const state = {
        fish: fish,
        buildings: buildings,
        lastTime: Date.now()
      };
      localStorage.setItem("gameState", JSON.stringify(state));
    }
    
    // Autoload: Load game state from localStorage
    function loadGame() {
      const savedState = localStorage.getItem("gameState");
      if (savedState) {
        const state = JSON.parse(savedState);
        fish = state.fish || 0;
        if (state.buildings) {
          buildings.forEach((b, index) => {
            if (state.buildings[index]) {
              b.count = state.buildings[index].count;
              b.cost = state.buildings[index].cost;
              b.level = state.buildings[index].level;
              b.upgradeCost = state.buildings[index].upgradeCost;
            }
          });
        }
        if (state.lastTime) {
          localStorage.setItem('lastTime', state.lastTime);
        }
      }
    }
    loadGame();
    
    // Autosave every 5 seconds
    setInterval(saveGame, 5000);
    
    /* ------------------------------------------
       DOM ELEMENTS
    ------------------------------------------- */
    const fishCountEl = document.getElementById('fishCount');
    const fishButton = document.getElementById('fishButton');
    const buildingListEl = document.getElementById('buildingList');
    const notificationEl = document.getElementById('notification');
    const statusBarEl = document.getElementById('statusBar');
    
    /* ------------------------------------------
       FISH COUNTER ANIMATION (for decreases)
    ------------------------------------------- */
    function animateNumber(start, end, element, duration) {
      let startTime = null;
      function animate(timestamp) {
        if (!startTime) startTime = timestamp;
        const progress = timestamp - startTime;
        const current = start - ((start - end) * (progress / duration));
        element.textContent = 'Fish: ' + Math.floor(current);
        if (progress < duration) {
          requestAnimationFrame(animate);
        } else {
          element.textContent = 'Fish: ' + Math.floor(end);
        }
      }
      requestAnimationFrame(animate);
    }
    
    function updateFishCount() {
      if (fish < displayedFish) {
        animateNumber(displayedFish, fish, fishCountEl, 500);
      } else {
        fishCountEl.textContent = 'Fish: ' + Math.floor(fish);
      }
      displayedFish = fish;
    }
    
    /* ------------------------------------------
       BUILDINGS DISPLAY & UPDATE
    ------------------------------------------- */
    function updateBuildings() {
      buildingListEl.innerHTML = '';
      buildings.forEach((building, index) => {
        const div = document.createElement('div');
        div.className = 'building';
        div.innerHTML = `
          <strong>${building.name}</strong><br>
          Owned: ${building.count}<br>
          Level: ${building.level}<br>
          Buy Cost: ${building.cost} Fish<br>
          Upgrade Cost: ${building.upgradeCost} Fish<br>
          Production: ${building.count * building.baseProduction * building.level} Fish/sec
        `;
        const buyBtn = document.createElement('button');
        buyBtn.textContent = `Buy ${building.name}`;
        buyBtn.addEventListener('click', () => buyBuilding(index));
        div.appendChild(buyBtn);
        const upgradeBtn = document.createElement('button');
        upgradeBtn.textContent = `Upgrade ${building.name} (Level +1)`;
        upgradeBtn.addEventListener('click', () => upgradeBuilding(index));
        div.appendChild(upgradeBtn);
        buildingListEl.appendChild(div);
      });
    }
    
    function buyBuilding(index) {
      const building = buildings[index];
      if (fish >= building.cost) {
        fish -= building.cost;
        building.count++;
        building.cost = Math.floor(building.cost * 1.15);
        updateFishCount();
        updateBuildings();
      } else {
        alert(`Not enough fish to buy a ${building.name}`);
      }
    }
    
    function upgradeBuilding(index) {
      const building = buildings[index];
      if (fish >= building.upgradeCost) {
        fish -= building.upgradeCost;
        building.level++;
        building.upgradeCost = Math.floor(building.upgradeCost * 2);
        updateFishCount();
        updateBuildings();
      } else {
        alert(`Not enough fish to upgrade ${building.name}`);
      }
    }
    
    /* ------------------------------------------
       MANUAL FISHING (Click to Earn)
    ------------------------------------------- */
    fishButton.addEventListener('click', () => {
      fish += 1;
      updateFishCount();
    });
    
    /* ------------------------------------------
       PRODUCTION CALCULATIONS & PASSIVE INCOME
    ------------------------------------------- */
    function totalProduction() {
      let production = 0;
      buildings.forEach(building => {
        production += building.count * building.baseProduction * building.level;
      });
      return production;
    }
    
    setInterval(() => {
      fish += totalProduction();
      updateFishCount();
    }, 1000);
    
    /* ------------------------------------------
       OFFLINE PROGRESS (Using localStorage)
    ------------------------------------------- */
    function checkOfflineProgress() {
      const lastTime = localStorage.getItem('lastTime');
      const now = Date.now();
      if (lastTime) {
        const secondsOffline = Math.floor((now - lastTime) / 1000);
        if (secondsOffline > 0) {
          const offlineFish = totalProduction() * secondsOffline;
          fish += offlineFish;
          showNotification(`While you were away for ${secondsOffline} seconds, your buildings caught ${Math.floor(offlineFish)} fish!`);
        }
      }
      localStorage.setItem('lastTime', now);
      updateFishCount();
    }
    
    function showNotification(message) {
      notificationEl.textContent = message;
      notificationEl.style.display = 'block';
      setTimeout(() => { notificationEl.style.display = 'none'; }, 5000);
    }
    
    /* ------------------------------------------
       STATUS BAR UPDATE (Clock, Day, Battery, Mobile Data)
    ------------------------------------------- */
    function updateStatusBar() {
      if (!isAndroid()) {
        statusBarEl.style.display = 'none';
        return;
      }
      // Ensure status bar is visible on Android
      statusBarEl.style.display = 'flex';
      document.body.classList.add('hasStatusBar');
      
      // Clock and Day
      const now = new Date();
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      const seconds = String(now.getSeconds()).padStart(2, '0');
      document.getElementById('clock').textContent = `${hours}:${minutes}:${seconds}`;
      // Display day as "Day: YYYY-MM-DD" (customize as needed)
      const dayStr = now.toISOString().split('T')[0];
      document.getElementById('day').textContent = `Day: ${dayStr}`;
      
      // Mobile Data: use Network Information API if available
      if (navigator.connection && navigator.connection.effectiveType) {
        document.getElementById('mobileData').textContent = `Data: ${navigator.connection.effectiveType}`;
      } else {
        document.getElementById('mobileData').textContent = `Data: N/A`;
      }
      
      // Battery Percentage: use Battery Status API if available
      if (navigator.getBattery) {
        navigator.getBattery().then(function(battery) {
          const level = Math.floor(battery.level * 100);
          document.getElementById('battery').textContent = `Battery: ${level}%`;
        });
      } else {
        document.getElementById('battery').textContent = `Battery: N/A`;
      }
    }
    // Update status bar every second
    setInterval(updateStatusBar, 1000);
    updateStatusBar();
    
    /* ------------------------------------------
       INITIALIZATION
    ------------------------------------------- */
    updateFishCount();
    updateBuildings();
    checkOfflineProgress();
    
    window.addEventListener('beforeunload', () => {
      localStorage.setItem('lastTime', Date.now());
      saveGame();
    });
  </script>
</body>
</html>
